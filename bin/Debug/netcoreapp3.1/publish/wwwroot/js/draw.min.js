"use strict";let users,newPath,resize_angle,drawingName="",id=null,choosen_id=null,undoList=[],redoList=[],points=[],app={type:"pen",color:"black",size:"5",fill:"transparent"},coordinates=[],cursorPosition={},differentPosition={},position={x:0,y:0},tempPoint1={},tempPoint2={},scale={x:1,y:1},current_scale={x:1,y:1},svgScale=1,object1=null,drag=!1,resize=!1,grab=!1,space=!1,svgDraw=$query("svg#draw");$query("#size").oninput=t=>{t.preventDefault(),app.size=$query("#size").value,$query("#preview").style.width=`${app.size/3}px`,$query("#preview").style.height=`${app.size/3}px`},$query("#color").oninput=t=>{t.preventDefault(),app.color=$query("#color").value,$query("#preview").style.border=`1px solid ${app.color}`},$query("#fill").oninput=t=>{t.preventDefault(),app.fill="#ffffff"==$query("#fill").value?"transparent":$query("#fill").value,$query("#preview").style.background=`${app.fill}`},$query("#drawName").onblur=t=>{t.preventDefault();var e=$query("#drawName").value;null!=e&&e||(e="Untitled"),$query("#drawName").value=e,con.invoke("AssignName",e)},$query("[id='leave']").onclick=()=>location="list.html",svgDraw.onpointerdown=svgDraw.onpointerenter=t=>{if(1==t.buttons&&t.isPrimary){t.preventDefault(),$query("#drawName").blur();let e=cursorPoint(t);if(choosen_id&&("svg"==t.target.tagName||"bg_grid"==t.target.id)&&select(),$query("#xcoord").innerHTML=simplifyNumber(e.x),$query("#ycoord").innerHTML=simplifyNumber(e.y),space&&"pointerdown"==t.type)grab=!0;else switch(app.type){case"pen":select();break;case"cursor":let i=["resize_nw","resize_n","resize_ne","resize_e","resize_se","resize_s","resize_sw","resize_w","line_x1","line_x2"];if(i.includes(t.target.id)&&choosen_id)resize_angle=t.target.id,cursorPosition=e,"line"==$query(`[id='${choosen_id}']`).tagName&&(tempPoint1={x:$query(`[id='${choosen_id}']`).getAttribute("x1"),y:$query(`[id='${choosen_id}']`).getAttribute("y1")},tempPoint2={x:$query(`[id='${choosen_id}']`).getAttribute("x2"),y:$query(`[id='${choosen_id}']`).getAttribute("y2")},object1=$query(`[id='${choosen_id}']`).cloneNode(!0)),drag=!1,resize=!0;else if(["path","rect","ellipse","text","image","line"].includes(t.target.tagName)&&!i.includes(t.target.id)&&"resize_border"!=t.target.id&&!t.target.classList.contains("notMoveable")){if(select(),choosen_id=t.target.id,!choosen_id)break;"line"==t.target.tagName?(tempPoint1={x:1*$query(`[id='${choosen_id}']`).getAttribute("x1"),y:1*$query(`[id='${choosen_id}']`).getAttribute("y1")},tempPoint2={x:1*$query(`[id='${choosen_id}']`).getAttribute("x2"),y:1*$query(`[id='${choosen_id}']`).getAttribute("y2")},select({x1:$query(`[id='${choosen_id}']`).getAttribute("x1"),x2:$query(`[id='${choosen_id}']`).getAttribute("x2"),y1:$query(`[id='${choosen_id}']`).getAttribute("y1"),y2:$query(`[id='${choosen_id}']`).getAttribute("y2")},!0)):select($query(`[id='${choosen_id}']`).getBBox()),cursorPosition=e,resize=!1,drag=!0}break;case"circle":case"rect":select(),newPath||(newPath=!0,cursorPosition={x:e.x,y:e.y});break;case"line":select();}}},svgDraw.onpointermove=async t=>{if(1==t.buttons&&t.isPrimary){t.preventDefault();let e=cursorPoint(t);if(grab&&space)svgDraw.setAttribute("x",+svgDraw.getAttribute("x")+t.movementX),svgDraw.setAttribute("y",+svgDraw.getAttribute("y")+t.movementY);else switch(redoUndoStatus("redo"),app.type){case"pen":if(!id)coordinates.push({x:e.x-t.movementX,y:e.y-t.movementY}),coordinates.push({x:e.x,y:e.y}),id=uuidv4(),startDraw(id,coordinates[0],app.color,app.size,app.fill),con.invoke("StartDraw",id,coordinates[0],app.color,app.size,app.fill);else if(e.x!=coordinates[1].x||e.y!=coordinates[1].y){coordinates.push({x:e.x,y:e.y}),coordinates=coordinates.slice(-3);let t=mid(coordinates[1],coordinates[2]);await draw(id,coordinates[1],t),con.invoke("Draw",id,coordinates[1],t),$query("#xcoord").innerHTML=simplifyNumber(e.x),$query("#ycoord").innerHTML=simplifyNumber(e.y)}break;case"cursor":if(!choosen_id)break;if(drag)$query(`[id='${choosen_id}']`).style.transform=`translate(${e.x-cursorPosition.x}px,${e.y-cursorPosition.y}px)`,$query("#resize_wrap")&&($query("#resize_wrap").style.transform=`translate(${e.x-cursorPosition.x}px,${e.y-cursorPosition.y}px)`),$query("#line_edit")&&($query("#line_edit").style.transform=`translate(${e.x-cursorPosition.x}px,${e.y-cursorPosition.y}px)`);else if(resize&&resize_angle){let i=$query(`[id='${choosen_id}']`).getBBox();if("resize_e"==resize_angle)current_scale.x=Math.max((e.x-(i.x+i.width)+i.width)/i.width,.1),$query(`[id='${choosen_id}']`).style.transform=`translate(${i.x}px,0) scale(${current_scale.x},${current_scale.y}) translate(${-i.x}px,0)`,$query("#resize_wrap").style.transform=`translate(${i.x}px,0) scale(${current_scale.x},${current_scale.y}) translate(${-i.x}px,0)`;else if("resize_w"==resize_angle)current_scale.x=Math.max((i.x-e.x+i.width)/i.width,.1),$query(`[id='${choosen_id}']`).style.transform=`translate(${i.x+i.width}px,0) scale(${current_scale.x},${current_scale.y}) translate(${-(i.x+i.width)}px,0)`,$query(`#resize_wrap`).style.transform=`translate(${i.x+i.width}px,0) scale(${current_scale.x},${current_scale.y}) translate(${-(i.x+i.width)}px,0)`;else if("resize_s"==resize_angle)current_scale.y=Math.max((e.y-(i.y+i.height)+i.height)/i.height,.1),$query(`[id='${choosen_id}']`).style.transform=`translate(0,${i.y}px) scale(${current_scale.x},${current_scale.y}) translate(0,${-i.y}px)`,$query(`#resize_wrap`).style.transform=`translate(0,${i.y}px) scale(${current_scale.x},${current_scale.y}) translate(0,${-i.y}px)`;else if("resize_n"==resize_angle)current_scale.y=Math.max((i.y-e.y+i.height)/i.height,.1),$query(`[id='${choosen_id}']`).style.transform=`translate(0,${i.y+i.height}px) scale(${current_scale.x},${current_scale.y}) translate(0,${-(i.y+i.height)}px)`,$query(`#resize_wrap`).style.transform=`translate(0,${i.y+i.height}px) scale(${current_scale.x},${current_scale.y}) translate(0,${-(i.y+i.height)}px)`;else if("resize_se"==resize_angle)current_scale={x:Math.max((e.x-(i.x+i.width)+i.width)/i.width,.1),y:Math.max((e.y-(i.y+i.height)+i.height)/i.height,.1)},t.shiftKey&&(current_scale.x>current_scale.y?current_scale.y=current_scale.x:current_scale.x=current_scale.y),$query(`[id='${choosen_id}']`).style.transform=`translate(${i.x}px,${i.y}px) scale(${current_scale.x},${current_scale.y}) translate(${-i.x}px,${-i.y}px)`,$query(`#resize_wrap`).style.transform=`translate(${i.x}px,${i.y}px) scale(${current_scale.x},${current_scale.y}) translate(${-i.x}px,${-i.y}px)`;else if("resize_nw"==resize_angle)current_scale={x:Math.max((i.x-e.x+i.width)/i.width,.1),y:Math.max((i.y-e.y+i.height)/i.height,.1)},t.shiftKey&&(current_scale.x>current_scale.y?current_scale.y=current_scale.x:current_scale.x=current_scale.y),$query(`[id='${choosen_id}']`).style.transform=`translate(${i.x+i.width}px,${i.y+i.height}px) scale(${current_scale.x},${current_scale.y}) translate(${-(i.x+i.width)}px,${-(i.y+i.height)}px)`,$query(`#resize_wrap`).style.transform=`translate(${i.x+i.width}px,${i.y+i.height}px) scale(${current_scale.x},${current_scale.y}) translate(${-(i.x+i.width)}px,${-(i.y+i.height)}px)`;else if("resize_ne"==resize_angle)current_scale={x:Math.max((e.x-(i.x+i.width)+i.width)/i.width,.1),y:Math.max((i.y-e.y+i.height)/i.height,.1)},t.shiftKey&&(current_scale.x>current_scale.y?current_scale.y=current_scale.x:current_scale.x=current_scale.y),$query(`[id='${choosen_id}']`).style.transform=`translate(${i.x}px,${i.y+i.height}px) scale(${current_scale.x},${current_scale.y}) translate(${-i.x}px,${-(i.y+i.height)}px)`,$query(`#resize_wrap`).style.transform=`translate(${i.x}px,${i.y+i.height}px) scale(${current_scale.x},${current_scale.y}) translate(${-i.x}px,${-(i.y+i.height)}px)`;else if("resize_sw"==resize_angle)current_scale={x:Math.max((i.x-e.x+i.width)/i.width,.1),y:Math.max((e.y-(i.y+i.height)+i.height)/i.height,.1)},t.shiftKey&&(current_scale.x>current_scale.y?current_scale.y=current_scale.x:current_scale.x=current_scale.y),$query(`[id='${choosen_id}']`).style.transform=`translate(${i.x+i.width}px,${i.y}px) scale(${current_scale.x},${current_scale.y}) translate(${-(i.x+i.width)}px,${-i.y}px)`,$query(`#resize_wrap`).style.transform=`translate(${i.x+i.width}px,${i.y}px) scale(${current_scale.x},${current_scale.y}) translate(${-(i.x+i.width)}px,${-i.y}px)`;else if("line_x1"==resize_angle){let t=comparePoint(e);cursorPosition=t?{x:t.x,y:t.y}:{x:simplifyNumber(e.x),y:simplifyNumber(e.y)},$query(`[id='${choosen_id}']`).setAttribute("x1",cursorPosition.x),$query(`[id='${choosen_id}']`).setAttribute("y1",cursorPosition.y),con.invoke("MoveObject","line",{id:choosen_id,x1:cursorPosition.x,y1:cursorPosition.y}),selectLine(choosen_id,cursorPosition)}else if("line_x2"==resize_angle){let t=comparePoint(e);cursorPosition=t?{x:t.x,y:t.y}:{x:simplifyNumber(e.x),y:simplifyNumber(e.y)},$query(`[id='${choosen_id}']`).setAttribute("x2",cursorPosition.x),$query(`[id='${choosen_id}']`).setAttribute("y2",cursorPosition.y),con.invoke("MoveObject","line",{id:choosen_id,x2:cursorPosition.x,y2:cursorPosition.y}),selectLine(choosen_id,cursorPosition)}}break;case"rect":if(!id){id=uuidv4();let t={x:e.x,y:e.y};startRect(id,t,app.color,app.size,app.fill),con.invoke("StartRect",id,t,app.color,app.size,app.fill)}let i=null;differentPosition={x:Math.abs(e.x-cursorPosition.x),y:Math.abs(e.y-cursorPosition.y)},t.shiftKey&&(differentPosition.x>differentPosition.y?differentPosition.y=differentPosition.x:differentPosition.x=differentPosition.y);let n={x:differentPosition.x,y:differentPosition.y};i=e.x<cursorPosition.x&&e.y<cursorPosition.y?{x:cursorPosition.x-differentPosition.x,y:cursorPosition.y-differentPosition.y}:e.x<cursorPosition.x?{x:cursorPosition.x-differentPosition.x,y:cursorPosition.y}:e.y<cursorPosition.y?{x:cursorPosition.x,y:cursorPosition.y-differentPosition.y}:{x:cursorPosition.x,y:cursorPosition.y},drawRect(id,i,n),con.invoke("DrawRect",id,i,n),$query("#xcoord").innerHTML=simplifyNumber(e.x),$query("#ycoord").innerHTML=simplifyNumber(e.y);break;case"circle":if(!id){id=uuidv4();let t={x:e.x,y:e.y};startCircle(id,t,app.color,app.size,app.fill),con.invoke("StartCircle",id,t,app.color,app.size,app.fill)}let r=null;differentPosition={x:Math.abs(e.x-cursorPosition.x),y:Math.abs(e.y-cursorPosition.y)},t.shiftKey&&(differentPosition.x>differentPosition.y?differentPosition.y=differentPosition.x:differentPosition.x=differentPosition.y);let d={x:differentPosition.x/2,y:differentPosition.y/2};r=0>e.x-cursorPosition.x&&0>e.y-cursorPosition.y?{x:cursorPosition.x-differentPosition.x/2,y:cursorPosition.y-differentPosition.y/2}:0>e.x-cursorPosition.x?{x:cursorPosition.x-differentPosition.x/2,y:cursorPosition.y+differentPosition.y/2}:0>e.y-cursorPosition.y?{x:cursorPosition.x+differentPosition.x/2,y:cursorPosition.y-differentPosition.y/2}:{x:cursorPosition.x+differentPosition.x/2,y:cursorPosition.y+differentPosition.y/2},drawCircle(id,r,d),con.invoke("DrawCircle",id,r,d),$query("#xcoord").innerHTML=simplifyNumber(e.x),$query("#ycoord").innerHTML=simplifyNumber(e.y);break;case"line":let u=comparePoint(e);id||(cursorPosition=u?u:e,id=uuidv4());let y=u?u:e;drawLine(id,{x:cursorPosition.x,y:cursorPosition.y},{x:y.x,y:y.y},app.color,app.size),con.invoke("DrawLine",id,{x:cursorPosition.x,y:cursorPosition.y},{x:y.x,y:y.y},app.color,app.size),$query("#xcoord").innerHTML=simplifyNumber(e.x),$query("#ycoord").innerHTML=simplifyNumber(e.y);}}},svgDraw.onpointerup=svgDraw.onpointerleave=async t=>{t.preventDefault();let e=cursorPoint(t);switch(grab&&(grab=!1),app.type){case"pen":if(id){coordinates.push({x:e.x,y:e.y}),coordinates=coordinates.slice(-3);let t=mid(coordinates[1],coordinates[2]);await draw(id,t,coordinates[2]),con.invoke("Draw",id,t,coordinates[2]),undoList.push({mode:"new",object:$query(`[id='${id}']`).cloneNode(!0)}),redoUndoStatus("undo",!0),con.invoke("InsertObjectIntoList",{id,object:getString($query(`[id='${id}']`))})}id=null,coordinates=[];break;case"cursor":let i=null;if(choosen_id){const e=window.getComputedStyle($query(`[id='${choosen_id}']`),null)?.transform,t="none"==e?null:e.match(/matrix.*\((.+)\)/)[1].split(", ").map(parseFloat);let n=$query(`[id='${choosen_id}']`);if(n.removeAttribute("style"),drag&&t){switch(position={x:t[4],y:t[5]},object1=n.cloneNode(!0),n.tagName){case"path":let e;const r=n.getAttribute("d").substring(1).split("Q");for(let t of r){let i=t.split(",").map(parseFloat);e?e+=`Q${simplifyNumber(i[0]+position.x)},${simplifyNumber(i[1]+position.y)},${simplifyNumber(i[2]+position.x)},${simplifyNumber(i[3]+position.y)}`:e=`M${simplifyNumber(i[0]+position.x)},${simplifyNumber(i[1]+position.y)}`}con.invoke("MoveObject","path",{id:choosen_id,d:e}),n.setAttribute("d",e);break;case"rect":n.setAttribute("x",+n.getAttribute("x")+position.x),n.setAttribute("y",+n.getAttribute("y")+position.y),con.invoke("MoveObject","rect",{id:choosen_id,x:n.getAttribute("x"),y:n.getAttribute("y")});break;case"ellipse":n.setAttribute("cx",+n.getAttribute("cx")+position.x),n.setAttribute("cy",+n.getAttribute("cy")+position.y),con.invoke("MoveObject","ellipse",{id:choosen_id,cx:n.getAttribute("cx"),cy:n.getAttribute("cy")});break;case"image":n.setAttribute("x",+n.getAttribute("x")+position.x),n.setAttribute("y",+n.getAttribute("y")+position.y),con.invoke("MoveObject","image",{id:choosen_id,x:n.getAttribute("x"),y:n.getAttribute("y")});break;case"line":n.setAttribute("x1",+n.getAttribute("x1")+position.x),n.setAttribute("x2",+n.getAttribute("x2")+position.x),n.setAttribute("y1",+n.getAttribute("y1")+position.y),n.setAttribute("y2",+n.getAttribute("y2")+position.y),select({x1:n.getAttribute("x1"),x2:n.getAttribute("x2"),y1:n.getAttribute("y1"),y2:n.getAttribute("y2")},!0),popPoint(tempPoint1),popPoint(tempPoint2),con.invoke("PopPoint",tempPoint1),con.invoke("PopPoint",tempPoint2),pushPoint({x:+n.getAttribute("x1"),y:+n.getAttribute("y1")}),pushPoint({x:+n.getAttribute("x2"),y:+n.getAttribute("y2")}),con.invoke("PushPoint",{x:+n.getAttribute("x1"),y:+n.getAttribute("y1")}),con.invoke("PushPoint",{x:+n.getAttribute("x2"),y:+n.getAttribute("y2")}),$query("#line_edit").removeAttribute("style"),con.invoke("MoveObject","line",{id:choosen_id,x1:n.getAttribute("x1"),y1:n.getAttribute("y1"),x2:n.getAttribute("x2"),y2:n.getAttribute("y2")});}i=$query(`[id='${choosen_id}']`).cloneNode(!0),undoList.push({mode:"move",object1:object1,object2:i}),redoUndoStatus("undo",!0),con.invoke("UpdateObjectInList",{id:choosen_id,object:getString($query(`[id='${choosen_id}']`))})}else if(resize&&t){let e={x:t[0],y:t[3]};switch(object1=n.cloneNode(!0),n.tagName){case"path":let t,r;const d=n.getAttribute("d").substring(1).split("Q");for(let e of d){let t=e.split(",").map(parseFloat);r?"resize_e"===resize_angle||"resize_s"===resize_angle||"resize_se"===resize_angle?r={x:Math.min(r.x,t[0],t[2]),y:Math.min(r.y,t[1],t[3])}:"resize_w"===resize_angle||"resize_n"===resize_angle||"resize_nw"===resize_angle?r={x:Math.max(r.x,t[0],t[2]),y:Math.max(r.y,t[1],t[3])}:"resize_ne"===resize_angle?r={x:Math.min(r.x,t[0],t[2]),y:Math.max(r.y,t[1],t[3])}:"resize_sw"===resize_angle?r={x:Math.max(r.x,t[0],t[2]),y:Math.min(r.y,t[1],t[3])}:void 0:r={x:t[0],y:t[1]}}r={x:r.x*e.x-r.x,y:r.y*e.y-r.y};for(let n of d){let i=n.split(",").map(parseFloat);t?t+=`Q${simplifyNumber(i[0]*e.x-r.x)},${simplifyNumber(i[1]*e.y-r.y)},${simplifyNumber(i[2]*e.x-r.x)},${simplifyNumber(i[3]*e.y-r.y)}`:t=`M${simplifyNumber(i[0]*e.x-r.x)},${simplifyNumber(i[1]*e.y-r.y)}`}n.setAttribute("d",t),con.invoke("MoveObject","path",{id:choosen_id,d:t});break;case"rect":const u=n.getBBox();"resize_w"==resize_angle||"resize_sw"==resize_angle?u.x-=u.width*e.x-u.width:"resize_n"==resize_angle||"resize_ne"==resize_angle?u.y-=u.height*e.y-u.height:"resize_nw"==resize_angle&&(u.x-=u.width*e.x-u.width,u.y-=u.height*e.y-u.height),n.setAttribute("x",u.x+position.x),n.setAttribute("y",u.y+position.y),n.setAttribute("width",u.width*e.x),n.setAttribute("height",u.height*e.y),con.invoke("MoveObject","rect",{id:choosen_id,x:n.getAttribute("x"),y:n.getAttribute("y"),width:n.getAttribute("width"),height:n.getAttribute("height")});break;case"image":const y=n.getBBox();"resize_w"==resize_angle||"resize_sw"==resize_angle?y.x-=y.width*e.x-y.width:"resize_n"==resize_angle||"resize_ne"==resize_angle?y.y-=y.height*e.y-y.height:"resize_nw"==resize_angle&&(y.x-=y.width*e.x-y.width,y.y-=y.height*e.y-y.height),n.setAttribute("x",y.x+position.x),n.setAttribute("y",y.y+position.y),n.setAttribute("width",y.width*e.x),n.setAttribute("height",y.height*e.y),con.invoke("MoveObject","rect",{id:choosen_id,x:n.getAttribute("x"),y:n.getAttribute("y"),width:n.getAttribute("width"),height:n.getAttribute("height")});break;case"ellipse":const o=n.getBBox();let s={cx:o.x+o.width/2,cy:o.y+o.height/2,rx:o.width/2,ry:o.height/2};"resize_e"===resize_angle?(s.rx=o.width*e.x/2,s.cx=o.x+s.rx):"resize_s"===resize_angle?(s.ry=o.height*e.y/2,s.cy=o.y+s.ry):"resize_se"===resize_angle?(s.rx=o.width*e.x/2,s.ry=o.height*e.y/2,s.cx=o.x+s.rx,s.cy=o.y+s.ry):"resize_w"===resize_angle?(s.rx=o.width*e.x/2,s.cx=o.x+o.width-s.rx):"resize_n"===resize_angle?(s.ry=o.height*e.y/2,s.cy=o.y+o.height-s.ry):"resize_nw"===resize_angle?(s.rx=o.width*e.x/2,s.ry=o.height*e.y/2,s.cx=o.x+o.width-s.rx,s.cy=o.y+o.height-s.ry):"resize_ne"===resize_angle?(s.rx=o.width*e.x/2,s.ry=o.height*e.y/2,s.cx=o.x+s.rx,s.cy=o.y+o.height-s.ry):"resize_sw"===resize_angle?(s.rx=o.width*e.x/2,s.ry=o.height*e.y/2,s.cx=o.x+o.width-s.rx,s.cy=o.y+s.ry):void 0,n.setAttribute("cx",s.cx),n.setAttribute("cy",s.cy),n.setAttribute("rx",s.rx),n.setAttribute("ry",s.ry),con.invoke("MoveObject","ellipse",{id:choosen_id,cx:n.getAttribute("cx"),cy:n.getAttribute("cy"),rx:n.getAttribute("rx"),ry:n.getAttribute("ry")});}i=$query(`[id='${choosen_id}']`).cloneNode(!0),undoList.push({mode:"move",object1:object1,object2:i}),redoUndoStatus("undo",!0),con.invoke("UpdateObjectInList",{id:choosen_id,object:getString($query(`[id='${choosen_id}']`))})}else resize&&"line"==$query(`[id='${choosen_id}']`).tagName&&(popPoint({x:1*tempPoint1.x,y:1*tempPoint1.y}),popPoint({x:1*tempPoint2.x,y:1*tempPoint2.y}),con.invoke("PopPoint",{x:1*tempPoint1.x,y:1*tempPoint1.y}),con.invoke("PopPoint",{x:1*tempPoint2.x,y:1*tempPoint2.y}),pushPoint({x:1*n.getAttribute("x1"),y:1*n.getAttribute("y1")}),pushPoint({x:1*n.getAttribute("x2"),y:1*n.getAttribute("y2")}),con.invoke("PushPoint",{x:1*n.getAttribute("x1"),y:1*n.getAttribute("y1")}),con.invoke("PushPoint",{x:1*n.getAttribute("x2"),y:1*n.getAttribute("y2")}),i=$query(`[id='${choosen_id}']`).cloneNode(!0),undoList.push({mode:"move",object1:object1,object2:i}),redoUndoStatus("undo",!0),con.invoke("UpdateObjectInList",{id:choosen_id,object:getString($query(`[id='${choosen_id}']`))}));"line"==$query(`[id='${choosen_id}']`).tagName?select({x1:$query(`[id='${choosen_id}']`).getAttribute("x1"),x2:$query(`[id='${choosen_id}']`).getAttribute("x2"),y1:$query(`[id='${choosen_id}']`).getAttribute("y1"),y2:$query(`[id='${choosen_id}']`).getAttribute("y2")},!0):select(n.getBBox())}differentPosition=cursorPosition=tempPoint1=tempPoint2={},current_scale={x:1,y:1},position={x:0,y:0},drag=resize=!1;break;case"rect":"pointerup"==t.type&&id&&(undoList.push({mode:"new",object:$query(`[id='${id}']`).cloneNode(!0)}),redoUndoStatus("undo",!0),con.invoke("InsertObjectIntoList",{id,object:getString($query(`[id='${id}']`))}));break;case"circle":"pointerup"==t.type&&id&&(undoList.push({mode:"new",object:$query(`[id='${id}']`).cloneNode(!0)}),redoUndoStatus("undo",!0),con.invoke("InsertObjectIntoList",{id,object:getString($query(`[id='${id}']`))}));break;case"line":if("pointerup"==t.type){let t={x:1*simplifyNumber(e.x),y:1*simplifyNumber(e.y)},i={x:1*simplifyNumber(cursorPosition.x),y:1*simplifyNumber(cursorPosition.y)};pushPoint(i),pushPoint(t),con.invoke("PushPoint",i),con.invoke("PushPoint",t),null!=id&&(undoList.push({mode:"new",object:$query(`[id='${id}']`).cloneNode(!0)}),redoUndoStatus("undo",!0),con.invoke("InsertObjectIntoList",{id,object:getString($query(`[id='${id}']`))}))}}},$query("#content").onmousewheel=t=>{t.ctrlKey&&(t.preventDefault(),0<t.wheelDelta/120&&3>svgScale?svgScale+=.05:.2<=svgScale&&(svgScale-=.05),svgDraw.setAttribute("width",simplifyNumber(1052*svgScale)),svgDraw.setAttribute("height",simplifyNumber(744*svgScale)),$query("#svgScale").innerText=`${(100*svgScale).toFixed(0)}%`)},document.body.onkeydown=function(t){(t.ctrlKey&&"90"==t.keyCode||t.ctrlKey&&"89"==t.keyCode)&&t.preventDefault()},document.addEventListener("keydown",t=>{8==t.keyCode||46==t.keyCode&&choosen_id?(undoList.push({mode:"remove",object:$query(`[id='${choosen_id}']`)}),redoUndoStatus("undo",!0),removeObject(choosen_id),con.invoke("RemoveObject",choosen_id),select()):t.ctrlKey&&"90"==t.keyCode&&!t.repeat?(select(),undo()):t.ctrlKey&&"89"==t.keyCode&&!t.repeat?(select(),redo()):32==t.keyCode?(space=!0,svgDraw.setAttribute("style","cursor: grab")):13==t.keyCode&&$query("#drawName").blur()},passiveSupport?{capture:!0,passive:!0}:{capture:!0}),document.addEventListener("keyup",t=>{32==t.keyCode&&(svgDraw.getAttribute("style")&&svgDraw.removeAttribute("style"),space=!1)},passiveSupport?{capture:!0,passive:!0}:{capture:!0}),document.onpointerup=t=>{t.preventDefault(),grab=!1,svgDraw.getAttribute("style")&&svgDraw.removeAttribute("style"),"pen"==app.type?(id=null,coordinates=[]):(differentPosition=cursorPosition={},newPath=id=null)},$query("#undo").onpointerdown=()=>{0==undoList.length||(select(),undo())},$query("#redo").onpointerdown=()=>{0==redoList.length||(select(),redo())},$query("#file").onchange=async t=>{let e=t.target.files[0],i=svgDraw.getAttribute("viewBox").split(" ");if(!(e&&e.type.startsWith("image/")))alert("Only image is allowed");else if(2e6<e.size)alert("The image cannot exceed 2MB");else{let t=await fit(e,i[2],i[3],"dataURL","image/webp"),n=uuidv4();insertImage(n,t.dataURL,{x:0,y:0},{x:t.nw,y:t.nh}),con.invoke("InsertObjectIntoList",{id:n,object:getString($query(`[id='${n}']`))}),con.invoke("InsertImage",n,t.dataURL,{x:0,y:0},{x:t.nw,y:t.nh}),undoList.push({mode:"new",object:$query(`[id='${n}']`).cloneNode(!0)}),redoUndoStatus("redo")}t.target.value=null},$query("#save input").onclick=async()=>{let e=svgDraw.cloneNode(!0);e.querySelectorAll("g").forEach(e=>e.remove());let t=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3508 2480">${e.innerHTML}</svg>`,i=document.createElement("canvas");i.width=3508,i.height=2480;let n=i.getContext("2d"),r=self.URL||self.webkitURL||self,d=new Image,u=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),y=r.createObjectURL(u);d.addEventListener("load",()=>{n.drawImage(d,0,0);let e=i.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="juzdraw.png",document.body.appendChild(t),t.click(),document.body.removeChild(t),r.revokeObjectURL(e)},{once:!0}),d.src=y},$query("#clear").onclick=()=>{reset(),con.invoke("Reset")},$query("#remove input").onclick=()=>{choosen_id&&(undoList.push({mode:"remove",object:$query(`[id='${choosen_id}']`)}),redoUndoStatus("undo",!0),removeObject(choosen_id),con.invoke("RemoveObject",choosen_id),select())};function passiveSupport(){let e=!1;try{const t={get passive(){e=!0}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}function $query(e){return 1==document.querySelectorAll(e).length?document.querySelector(e):1<document.querySelectorAll(e).length?document.querySelectorAll(e):null}function menu(e){app.type=e;let t=$query("#type").children;for(let n=0;n<t.length;n++)t[n].classList.remove("typeActive");$query(`#${e}`).classList.add("typeActive"),select()}let getString=function(){let e=document.createElement("div");return"outerHTML"in e?function(e){return e.outerHTML}:function(t){let i=e.cloneNode();return i.appendChild(t.cloneNode(!0)),i.innerHTML}}();function simplifyNumber(e){return isNaN(e)?void 0:0==(+e).toFixed(2)%1?(+e).toFixed(0):(+e).toFixed(2)}function uuidv4(){return"10000000100040008000100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function comparePoint(e){if(!points)return null;for(let t of points)if(e.x>=t.x-10&&e.x<=t.x+10&&e.y>=t.y-10&&e.y<=t.y+10)return t}function selectLine(e,t){let i=$query(`[id='${e}']`);if(i&&0!=Object.entries(t))if("line_x1"==resize_angle){let e=$query("#line_x1");e.x.baseVal.value=t.x-20,e.y.baseVal.value=t.y-20}else{let e=$query("#line_x2");e.x.baseVal.value=t.x-20,e.y.baseVal.value=t.y-20}}function select(e,t=!1){if($query("#resize_wrap")&&svgDraw.removeChild($query("#resize_wrap")),$query("#line_edit")&&svgDraw.removeChild($query("#line_edit")),!e)return void(choosen_id=null);let i="";t?(i=`<g id="line_edit"><rect id="line_x1" class='notMoveable' width="40" height="40" x="${e.x1-20}" y="${e.y1-20}" style="cursor:move" /><rect id="line_x2" class='notMoveable' width="40" height="40" x="${e.x2-20}" y="${e.y2-20}" style="cursor:move"/></g>`,$query("#xcoord").innerHTML=simplifyNumber(e.x1-20),$query("#ycoord").innerHTML=simplifyNumber(e.y1-20)):(i=`<g id="resize_wrap"><rect id="resize_border" class='notMoveable' fill="none" stroke="blue" stroke-width="1px" x="${e.x-25}" y="${e.y-25}" width="${e.width+50}" height="${e.height+50}" /><rect id="resize_nw" class="notMoveable" stroke-width="10" width="1" height="1" x="${e.x-25}" y="${e.y-25}" style="cursor:nw-resize"/><rect id="resize_n" class='notMoveable' stroke-width="10" width="1" height="1" x="${e.x+e.width/2}" y="${e.y-26}" style="cursor:n-resize" /><rect id="resize_ne" class='notMoveable' stroke-width="10" width="1" height="1" x="${e.x+e.width+25}" y="${e.y-25}" style="cursor:ne-resize" /><rect id="resize_e" class='notMoveable' stroke-width="10" width="1" height="1" x="${e.x+e.width+26}" y="${e.y+e.height/2}" style="cursor:e-resize"/><rect id="resize_se" class='notMoveable' stroke-width="10" width="1" height="1" x="${e.x+e.width+25}" y="${e.y+e.height+25}" style="cursor:se-resize" /><rect id="resize_s" class='notMoveable' stroke-width="10" width="1" height="1"  x="${e.x+e.width/2}" y="${e.y+e.height+26}" style="cursor:s-resize"/><rect id="resize_sw" class='notMoveable' stroke-width="10" width="1" height="1" x="${e.x-25}" y="${e.y+e.height+25}" style="cursor:sw-resize"/><rect id="resize_w" class='notMoveable' stroke-width="10" width="1" height="1" x="${e.x-26}" y="${e.y+e.height/2}" style="cursor:w-resize"/></g>`,$query("#xcoord").innerHTML=simplifyNumber(e.x),$query("#ycoord").innerHTML=simplifyNumber(e.y)),svgDraw.insertAdjacentHTML("beforeend",i)}function redoUndoStatus(e,t=!1){null==e||("undo"==e?($query("#undo").classList.remove("btnAble"),$query("#undo").classList.remove("btnDisable"),t?$query("#undo").classList.add("btnAble"):undoList=[]):"redo"==e&&($query("#redo").classList.remove("btnAble"),$query("#redo").classList.remove("btnDisable"),t?$query("#redo").classList.add("btnAble"):redoList=[]))}let mid=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2});function insertImage(e,t,i,n){let r=document.createElementNS("http://www.w3.org/2000/svg","image");r.id=e,r.href.baseVal=t,r.x.baseVal.value=i.x,r.y.baseVal.value=i.y,r.width.baseVal.value=n.x,r.height.baseVal.value=n.y,r.setAttribute("preserveAspectRatio","none"),svgDraw.appendChild(r)}function startDraw(e,t,i,n,r){let d=document.createElementNS("http://www.w3.org/2000/svg","path");d.id=e,d.setAttribute("d",`M${simplifyNumber(t.x)},${simplifyNumber(t.y)}`),d.setAttribute("stroke",i),d.setAttribute("fill",r),d.setAttribute("stroke-width",`${n}px`),svgDraw.appendChild(d)}function draw(e,t,i){return Promise.resolve().then(()=>{let n=$query(`[id='${e}']`);n.setAttribute("d",`${n.getAttribute("d")}Q${simplifyNumber(t.x)},${simplifyNumber(t.y)},${simplifyNumber(i.x)},${simplifyNumber(i.y)}`),svgDraw.appendChild(n)})}function startRect(e,t,i,n,r){let d=document.createElementNS("http://www.w3.org/2000/svg","rect");d.id=e,d.x.baseVal.value=simplifyNumber(t.x),d.y.baseVal.value=simplifyNumber(t.y),d.setAttribute("stroke",i),d.setAttribute("fill",r),d.setAttribute("stroke-width",n+"px"),svgDraw.appendChild(d)}function drawRect(e,t,i){let n=$query(`[id='${e}']`);n.x.baseVal.value=simplifyNumber(t.x),n.y.baseVal.value=simplifyNumber(t.y),n.width.baseVal.value=simplifyNumber(i.x),n.height.baseVal.value=simplifyNumber(i.y)}function startCircle(e,t,i,n,r){let d=document.createElementNS("http://www.w3.org/2000/svg","ellipse");d.id=e,d.cx.baseVal.value=simplifyNumber(t.x),d.cy.baseVal.value=simplifyNumber(t.y),d.setAttribute("stroke",i),d.setAttribute("fill",r),d.setAttribute("stroke-width",n+"px"),svgDraw.appendChild(d)}function drawCircle(e,t,i){let n=$query(`[id='${e}']`);n.rx.baseVal.value=simplifyNumber(i.x),n.ry.baseVal.value=simplifyNumber(i.y),n.cx.baseVal.value=simplifyNumber(t.x),n.cy.baseVal.value=simplifyNumber(t.y)}function drawLine(e,t,i,n,r){let d=$query(`[id='${e}']`);d||(d=document.createElementNS("http://www.w3.org/2000/svg","line"),d.id=e,d.setAttribute("stroke",n),d.setAttribute("stroke-width",r),d.x1.baseVal.value=simplifyNumber(t.x),d.y1.baseVal.value=simplifyNumber(t.y)),d.x2.baseVal.value=simplifyNumber(i.x),d.y2.baseVal.value=simplifyNumber(i.y),svgDraw.appendChild(d)}let pushPoint=e=>points.push(e),popPoint=e=>points=points.filter(t=>t.x!=1*e.x&&t.y!=1*e.y);function removeObject(e,t=!1){"line"==$query(`[id='${e}']`)?.tagName&&(popPoint({x:1*$query(`[id='${e}']`).getAttribute("x1"),y:1*$query(`[id='${e}']`).getAttribute("y1")}),popPoint({x:1*$query(`[id='${e}']`).getAttribute("x2"),y:1*$query(`[id='${e}']`).getAttribute("y2")}),con.invoke("PopPoint",{x:1*$query(`[id='${e}']`).getAttribute("x1"),y:1*$query(`[id='${e}']`).getAttribute("y1")}),con.invoke("PopPoint",{x:1*$query(`[id='${e}']`).getAttribute("x2"),y:1*$query(`[id='${e}']`).getAttribute("y2")})),$query(`[id='${e}']`).remove(),t&&select()}function reset(){redoUndoStatus("undo"),redoUndoStatus("redo"),svgDraw.innerHTML=`<g><defs><pattern id="smallGrid" width="24" height="24" patternUnits="userSpaceOnUse"><path d="M24,0L0,0,0,24" fill="none" stroke="#cccccc" stroke-width="1" /></pattern><pattern id="grid" width="240" height="240" patternUnits="userSpaceOnUse"><rect width="240" height="240" fill="url(#smallGrid)" /><path d="M240,0L0,0,0,240" fill="none" stroke="#cccccc" stroke-width="2" /></pattern></defs><rect width="100%" height="100%" fill="white" class="notMoveable" /><rect id="bg_grid" width="100%" height="100%" fill="url(#grid)" class="notMoveable" /></g><g id="cursors"></g>`,select()}let create=e=>svgDraw.appendChild(e);function moveObject(e,t){choosen_id==t.id&&select();"path"===e?$query(`[id='${t.id}']`).setAttribute("d",t.d):"ellipse"===e?(t.cx&&t.cy&&($query(`[id='${t.id}']`).setAttribute("cx",t.cx),$query(`[id='${t.id}']`).setAttribute("cy",t.cy)),t.rx&&t.ry&&($query(`[id='${t.id}']`).setAttribute("rx",t.rx),$query(`[id='${t.id}']`).setAttribute("ry",t.ry))):"rect"===e?(t.x&&t.y&&($query(`[id='${t.id}']`).setAttribute("x",t.x),$query(`[id='${t.id}']`).setAttribute("y",t.y)),t.width&&t.height&&($query(`[id='${t.id}']`).setAttribute("width",t.width),$query(`[id='${t.id}']`).setAttribute("height",t.height))):"image"===e?(t.x&&t.y&&($query(`[id='${t.id}']`).setAttribute("x",t.x),$query(`[id='${t.id}']`).setAttribute("y",t.y)),t.width&&t.height&&($query(`[id='${t.id}']`).setAttribute("width",t.width),$query(`[id='${t.id}']`).setAttribute("height",t.height))):"line"===e?(t.x1&&t.y1&&($query(`[id='${t.id}']`).setAttribute("x1",t.x1),$query(`[id='${t.id}']`).setAttribute("y1",t.y1)),t.x2&&t.y2&&($query(`[id='${t.id}']`).setAttribute("x2",t.x2),$query(`[id='${t.id}']`).setAttribute("y2",t.y2))):void 0}function undo(){if(0!=undoList.length){let e=undoList.pop();if("new"==e.mode){let t=e.object.getAttribute("id");removeObject(t),con.invoke("RemoveObject",t)}else if("move"==e.mode){let t=e.object1.getAttribute("id"),i=e.object2.getAttribute("id");t==i&&(removeObject(t),con.invoke("RemoveObject",t),svgDraw.appendChild(e.object1),con.invoke("Create",getString(e.object1)))}else"remove"==e.mode&&(svgDraw.appendChild(e.object),con.invoke("Create",getString(e.object)));redoList.push(e),0==undoList.length&&redoUndoStatus("undo"),redoUndoStatus("redo",!0)}}function redo(){if(0!=redoList.length){let e=redoList.pop();if("new"==e.mode)svgDraw.appendChild(e.object),con.invoke("Create",getString(e.object).replace(/\"/gi,"'"));else if("move"==e.mode){let t=e.object1.getAttribute("id"),i=e.object2.getAttribute("id");t==i&&(removeObject(t),con.invoke("RemoveObject",t),svgDraw.appendChild(e.object2),con.invoke("Create",getString(e.object2)))}else if("remove"==e.mode){let t=e.object.getAttribute("id");removeObject(t),con.invoke("RemoveObject",t)}undoList.push(e),redoUndoStatus("undo",!0),0==redoList.length&&redoUndoStatus("redo")}}function createObject(e){return new Promise(()=>{let t=new DOMParser().parseFromString(e,"image/svg+xml").firstChild;switch(t.tagName){case"path":let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("id",t.getAttribute("id")),e.setAttribute("d",t.getAttribute("d")),e.setAttribute("fill",t.getAttribute("fill")),e.setAttribute("stroke",t.getAttribute("stroke")),e.setAttribute("stroke-width",t.getAttribute("stroke-width")),svgDraw.appendChild(e);break;case"ellipse":let i=document.createElementNS("http://www.w3.org/2000/svg","ellipse");i.setAttribute("id",t.getAttribute("id")),i.setAttribute("cx",t.getAttribute("cx")),i.setAttribute("cy",t.getAttribute("cy")),i.setAttribute("rx",t.getAttribute("rx")),i.setAttribute("ry",t.getAttribute("ry")),i.setAttribute("fill",t.getAttribute("fill")),i.setAttribute("stroke",t.getAttribute("stroke")),i.setAttribute("stroke-width",t.getAttribute("stroke-width")),svgDraw.appendChild(i);break;case"rect":let n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("id",t.getAttribute("id")),n.setAttribute("stroke",t.getAttribute("stroke")),n.setAttribute("stroke-width",t.getAttribute("stroke-width")),n.setAttribute("x",t.getAttribute("x")),n.setAttribute("y",t.getAttribute("y")),n.setAttribute("fill",t.getAttribute("fill")),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),svgDraw.appendChild(n);break;case"line":let r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("id",t.getAttribute("id")),r.setAttribute("x1",t.getAttribute("x1")),r.setAttribute("y1",t.getAttribute("y1")),r.setAttribute("x2",t.getAttribute("x2")),r.setAttribute("y2",t.getAttribute("y2")),r.setAttribute("stroke",t.getAttribute("stroke")),r.setAttribute("stroke-width",t.getAttribute("stroke-width")),r.setAttribute("fill",t.getAttribute("fill")),svgDraw.appendChild(r);break;case"image":let d=document.createElementNS("http://www.w3.org/2000/svg","image");d.setAttribute("id",t.getAttribute("id")),d.setAttribute("x",t.getAttribute("x")),d.setAttribute("y",t.getAttribute("y")),d.setAttribute("href",t.getAttribute("href")),d.setAttribute("preserveAspectRatio","none"),d.setAttribute("width",t.getAttribute("width")),d.setAttribute("height",t.getAttribute("height")),svgDraw.appendChild(d);}})}let pt=svgDraw.createSVGPoint();function cursorPoint(e){pt.x=e.clientX,pt.y=e.clientY;let t=pt.matrixTransform(svgDraw.getScreenCTM().inverse());return{x:0>t.x?0:3508<t.x?3508:t.x,y:0>t.y?0:2480<t.y?2480:t.y}}const name=sessionStorage.getItem("name"),roomId=new URL(location).searchParams.get("roomId");if(!roomId)throw location="list.html","ERROR: Invalid game id";if(!name)throw location="main.html?","ERROR: Invalid name";const con=new signalR.HubConnectionBuilder().withUrl(`/hub?page=draw&name=${name}&roomId=${roomId}`).withAutomaticReconnect().build();con.onclose(()=>{alert("Disconnect"),location="main.html?"}),con.on("StartDraw",startDraw),con.on("Draw",async(e,t,i)=>await draw(e,t,i)),con.on("StartRect",startRect),con.on("DrawRect",drawRect),con.on("StartCircle",startCircle),con.on("DrawCircle",drawCircle),con.on("DrawLine",drawLine),con.on("PushPoint",pushPoint),con.on("PopPoint",popPoint),con.on("RemoveObject",e=>removeObject(e,!0)),con.on("Reset",reset),con.on("MoveObject",moveObject),con.on("Create",createObject),con.on("InsertImage",insertImage),con.on("UpdateName",e=>$query("#drawName").value=e),con.on("UserJoin",e=>{e=JSON.parse(e),document.getElementById("status").hidden=!1,document.getElementById("status").innerHTML=`<b>${e.Name}</b> Join`,setTimeout(()=>{document.getElementById("status").hidden=!0},3e3)}),con.on("UserLeft",e=>{e=JSON.parse(e),document.getElementById("status").hidden=!1,document.getElementById("status").innerHTML=`<b>${e.Name}</b> Left`,setTimeout(()=>{document.getElementById("status").hidden=!0},3e3),removeObject(e.Id,!0)}),con.on("UpdateCursor",(e,t,i)=>Promise.resolve().then(()=>{let n=$query(`#cursors [id='${e}']`);n?(n.x.baseVal.value=t.x,n.y.baseVal.value=t.y):$query("#cursors").insertAdjacentHTML("beforeend",`<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" id="${e}" x="${t.x}" y="${t.y}"><path class="notMovable" fill="${i}" d="M4 0l16 12.279-6.951 1.17 4.325 8.817-3.596 1.734-4.35-8.879-5.428 4.702z" /></svg>`),svgDraw.appendChild($query("#cursors"))})),con.on("UpdateUserList",e=>{let t=0,i=0,n="";JSON.parse(e).forEach(e=>{n+=`<div class="userlist" title="${e.Name}" style="top:${t}px; background-color: ${e.Color}" >${e.Name.toString().charAt(0).toUpperCase()}</div>`,t+=50,i++}),$query("#users").innerHTML=n,$query("#userNo").innerHTML=i}),con.on("Restore",(e,t,i)=>Promise.resolve().then(()=>{$query("#drawName").value=e,JSON.parse(t).forEach(e=>createObject(e.Object)),JSON.parse(i).forEach(e=>points.push({x:e.X,y:e.Y}))})),con.on("Reject",()=>location="list.html"),con.start().then(()=>{menu("pen"),$query("#main").hidden=!1,$query("#connectionStatus").hidden=!0,svgDraw.setAttribute("width",1052),svgDraw.setAttribute("height",744),svgDraw.setAttribute("x",(window.screen.width-svgDraw.getAttribute("width"))/2),svgDraw.setAttribute("y",10),$query("#svgScale").innerText=`${100*svgScale}%`,app.size=$query("#size").value,app.color=$query("#color").value,app.fill="#ffffff"==$query("#fill").value?"transparent":$query("#fill").value,$query("#preview").style.width=`${app.size}px`,$query("#preview").style.height=`${app.size}px`,$query("#preview").style.border=`1px solid ${app.color}`,$query("#preview").style.background=`${app.fill}`,svgDraw.addEventListener("pointermove",t=>{let e=cursorPoint(t);con.invoke("UpdateCursor",{X:e.x,Y:e.y})},!!passiveSupport&&{passive:!0})}),con.onreconnecting(()=>{$query("#connectionStatus").hidden=!1,$query("#connectionStatus").innerText="Reconnecting..."}),con.onreconnected(()=>{$query("#connectionStatus").innerText="Reconnected!",setTimeout(()=>$query("#connectionStatus").hidden=!0,2e3)});